# –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã Uchat

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ

### 1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- **Database** - –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î (SQLite + LiteDB)
- **Uchat.Server** - API + SignalR Hub
- **LoginFormAvalonia** - —Ñ–æ—Ä–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **Uchat** - –æ—Å–Ω–æ–≤–Ω–æ–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–∞—Ç–∞

### 2. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã —Å refresh —Ç–æ–∫–µ–Ω–∞–º–∏
- ‚úÖ BCrypt –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
- ‚úÖ Middleware –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

### 3. Real-time —á–∞—Ç
- ‚úÖ SignalR –¥–ª—è —Ä–µ–∞–ª-—Ç–∞–π–º —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ LiteDB –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

### 1. **–ö–†–ò–¢–ò–ß–ù–û: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π catch –≤ LoginAsync**
**–§–∞–π–ª:** `Uchat.Server/Services/Auth/AuthService.cs:88`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```csharp
try {
    // –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è
} catch (Exception ex) {
    Console.WriteLine(ex.Message); // ‚ùå –ü–∏—à–µ—Ç "Invalid credentials" –Ω–æ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ!
}
// –ö–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å existingUser = null –∏ –ø–∞–¥–∞–µ—Ç –¥–∞–ª—å—à–µ
```

**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –£–ñ–ï –ò–°–ü–†–ê–í–õ–ï–ù–û - —É–±—Ä–∞–ª –ª–∏—à–Ω–∏–π try-catch

### 2. –ü–µ—Ä–µ–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–∞ –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** LoginFormAvalonia –∏ Uchat - —ç—Ç–æ –¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö `.exe` —Ñ–∞–π–ª–∞. 
–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ Uchat –∏–∑ LoginForm —Ç–æ–∫–µ–Ω —Ç–µ—Ä—è–ª—Å—è.

**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –£–ñ–ï –ò–°–ü–†–ê–í–õ–ï–ù–û - –ø–µ—Ä–µ–¥–∞—á–∞ —á–µ—Ä–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏:
```csharp
// LoginForm
Uchat.exe --token "xxx" --username "PenisMaster" --userId 2

// Uchat Program.cs
ParseCommandLineArgs(args);
```



## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### –í–∞—Ä–∏–∞–Ω—Ç –ê: –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞)
```
Uchat/                          # Solution root
‚îú‚îÄ‚îÄ Database/                   # ‚úÖ Shared library
‚îú‚îÄ‚îÄ Uchat.Server/              # ‚úÖ Backend API + SignalR
‚îú‚îÄ‚îÄ LoginFormAvalonia/         # ‚ö†Ô∏è –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ Uchat.LoginForm
‚îî‚îÄ‚îÄ Uchat/                     # ‚ö†Ô∏è –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ Uchat.Client
```

**–ü–ª—é—Å—ã:**
- –ü—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- –õ–µ–≥–∫–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- Shared code –≤ Database

**–ú–∏–Ω—É—Å—ã:**
- –î–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞ (LoginForm + Client)
- –ù—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç—ã

### –í–∞—Ä–∏–∞–Ω—Ç –ë: –û–±—ä–µ–¥–∏–Ω–∏—Ç—å LoginForm –∏ Uchat –≤ –æ–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å
```
Uchat/
‚îú‚îÄ‚îÄ Database/
‚îú‚îÄ‚îÄ Uchat.Server/
‚îî‚îÄ‚îÄ Uchat.Client/              # Avalonia app
    ‚îú‚îÄ‚îÄ Views/
    ‚îÇ   ‚îú‚îÄ‚îÄ LoginWindow.axaml  # –ë—ã–≤—à–∏–π LoginFormAvalonia
    ‚îÇ   ‚îî‚îÄ‚îÄ ChatWindow.axaml   # –ë—ã–≤—à–∏–π Uchat
    ‚îî‚îÄ‚îÄ Services/
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –û–¥–∏–Ω .exe —Ñ–∞–π–ª
- ‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å –ø–µ—Ä–µ–¥–∞—á–µ–π —Ç–æ–∫–µ–Ω–∞
- ‚úÖ –û–±—â–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É –æ–∫–Ω–∞–º–∏

**–ú–∏–Ω—É—Å—ã:**
- –¢—Ä–µ–±—É–µ—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

### –í–∞—Ä–∏–∞–Ω—Ç –í: –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–¥–ª—è –±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤)
```
Uchat/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ Uchat.Domain/          # Entities, Interfaces
‚îÇ   ‚îú‚îÄ‚îÄ Uchat.Application/     # Business logic, Services
‚îÇ   ‚îú‚îÄ‚îÄ Uchat.Infrastructure/  # Database, External APIs
‚îÇ   ‚îú‚îÄ‚îÄ Uchat.API/            # Web API + SignalR
‚îÇ   ‚îî‚îÄ‚îÄ Uchat.Client/         # Avalonia Desktop
‚îî‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ Uchat.Tests.Unit/
    ‚îî‚îÄ‚îÄ Uchat.Tests.Integration/
```


### ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤–∞–∂–Ω—ã–µ endpoints

**–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:**
```csharp
// Messages API
GET  /api/messages/{chatId}           # –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
GET  /api/messages/{chatId}/search    # –ü–æ–∏—Å–∫ –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º
POST /api/messages/{messageId}/edit   # –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
DELETE /api/messages/{messageId}      # –£–¥–∞–ª–µ–Ω–∏–µ

// Chats API
GET  /api/chats                       # –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
POST /api/chats                       # –°–æ–∑–¥–∞—Ç—å —á–∞—Ç
GET  /api/chats/{id}/members          # –£—á–∞—Å—Ç–Ω–∏–∫–∏ —á–∞—Ç–∞

// Users API
GET  /api/users/me                    # –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
PUT  /api/users/me                    # –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
GET  /api/users/search                # –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```

## üéØ –ú–æ—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–î–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞:**

1. **–û—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É**, –Ω–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å:
   - `LoginFormAvalonia` ‚Üí `Uchat.Auth`
   - `Uchat` ‚Üí `Uchat.Desktop`

2. **–î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ API endpoints** (—Å–º. –≤—ã—à–µ)

3. **–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π:**
```csharp
[ApiController]
[Route("api/messages")]
public class MessagesController : ControllerBase
{
    // GET /api/messages/{chatId}?limit=50&before=timestamp
    [HttpGet("{chatId}")]
    public async Task<IActionResult> GetHistory(
        string chatId, 
        int limit = 50, 
        DateTime? before = null)
    {
        // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º LiteDB
    }
}
```

4. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å warnings:**
```csharp
// User.cs:111 –∏ :76
public required RefreshToken User { get; set; }
public required ICollection<SecurityToken> SecurityTokens { get; set; } = new List<SecurityToken>();
```

## üìù –ò—Ç–æ–≥–æ

**–ß—Ç–æ —É–∂–µ –æ—Ç–ª–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- ‚úÖ JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ SignalR real-time —á–∞—Ç
- ‚úÖ LiteDB –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –ü–µ—Ä–µ–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–∞ –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏

**–ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:**
- ‚ö†Ô∏è API –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚ö†Ô∏è API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–∞—Ç–∞–º–∏
- ‚ö†Ô∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚ö†Ô∏è –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:** –ü–æ–¥—Ö–æ–¥—è—â–∞—è –¥–ª—è —Å—Ä–µ–¥–Ω–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ.
