/*
 * ============================================================================
 * ENTITY MODEL: CONTACT (Контакт/Друг)
 * ============================================================================
 * 
 * Это модель для списка контактов пользователя (друзья, избранное).
 * 
 * ЗАЧЕМ ЭТО НУЖНО?
 * - Быстрый доступ к часто используемым контактам
 * - Адресная книга (с псевдонимами)
 * - Блокировка нежелательных пользователей
 * - Избранные контакты
 * 
 * ВАЖНО:
 * Связь контактов ОДНОСТОРОННЯЯ!
 * Если User A добавил User B в контакты, это НЕ значит, что B добавил A.
 * 
 * Для двусторонней дружбы (как в Facebook) нужна другая модель.
 * 
 * ============================================================================
 */

namespace Uchat.Database.Entities;

/// <summary>
/// Контакт в списке пользователя
/// Представляет таблицу Contacts в базе данных
/// 
/// Это односторонняя связь: "Я добавил его в контакты"
/// </summary>
public class Contact
{
    // ========================================================================
    // PRIMARY KEY
    // ========================================================================
    
    /// <summary>
    /// Уникальный ID контакта
    /// В БД: INTEGER PRIMARY KEY AUTOINCREMENT
    /// </summary>
    public int Id { get; set; }
    
    // ========================================================================
    // FOREIGN KEYS
    // ========================================================================
    
    /// <summary>
    /// ID владельца списка контактов (кто добавил контакт)
    /// Foreign Key -> Users.Id
    /// В БД: INTEGER NOT NULL
    /// 
    /// Это "МОЙ" список контактов
    /// </summary>
    public int OwnerId { get; set; }
    
    /// <summary>
    /// ID пользователя, которого добавили в контакты
    /// Foreign Key -> Users.Id
    /// В БД: INTEGER NOT NULL
    /// 
    /// Это "КТО" находится в моих контактах
    /// </summary>
    public int ContactUserId { get; set; }
    
    // ========================================================================
    // ДОПОЛНИТЕЛЬНАЯ ИНФОРМАЦИЯ
    // ========================================================================
    
    /// <summary>
    /// Псевдоним для этого контакта (опционально)
    /// В БД: VARCHAR(100) NULL
    /// 
    /// Позволяет дать пользователю кастомное имя:
    /// - Реальный username: "john_doe_123"
    /// - Nickname в контактах: "Джон (работа)"
    /// 
    /// NULL = использовать DisplayName пользователя
    /// </summary>
    public string? Nickname { get; set; }
    
    /// <summary>
    /// Когда контакт был добавлен
    /// В БД: DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
    /// 
    /// Полезно для:
    /// - Сортировки (недавно добавленные)
    /// - Статистики (сколько контактов добавлено за месяц)
    /// </summary>
    public DateTime AddedAt { get; set; }
    
    // ========================================================================
    // ФЛАГИ И ДОПОЛНИТЕЛЬНЫЕ ПОЛЯ
    // ========================================================================

    /// <summary>
    /// Заблокирован ли этот контакт
    /// В БД: BOOLEAN NOT NULL DEFAULT 0
    /// </summary>
    public bool IsBlocked { get; set; }

    /// <summary>
    /// Находится ли в избранном
    /// В БД: BOOLEAN NOT NULL DEFAULT 0
    /// </summary>
    public bool IsFavorite { get; set; }

    /// <summary>
    /// Приватные заметки владельца о контакте
    /// В БД: VARCHAR(500) NULL
    /// </summary>
    public string? Notes { get; set; }

    /// <summary>
    /// Включены ли уведомления для этого контакта
    /// В БД: BOOLEAN NOT NULL DEFAULT 1
    /// </summary>
    public bool NotificationsEnabled { get; set; } = true;
    
    // ========================================================================
    // НАВИГАЦИОННЫЕ СВОЙСТВА
    // ========================================================================
    
    /// <summary>
    /// Владелец списка контактов (я)
    /// Navigation property для OwnerId
    /// 
    /// Использование:
    ///   var contact = await context.Contacts
    ///       .Include(c => c.Owner)
    ///       .FirstAsync(c => c.Id == 10);
    ///   
    ///   Console.WriteLine($"Контакт пользователя: {contact.Owner.Username}");
    /// </summary>
    public User Owner { get; set; } = null!;
    
    /// <summary>
    /// Сам контакт (пользователь, которого добавили)
    /// Navigation property для ContactUserId
    /// 
    /// Использование:
    ///   var myContacts = await context.Contacts
    ///       .Include(c => c.ContactUser)
    ///       .Where(c => c.OwnerId == myUserId && !c.IsBlocked)
    ///       .ToListAsync();
    ///   
    ///   foreach (var contact in myContacts) {
    ///       var displayName = contact.Nickname ?? contact.ContactUser.DisplayName;
    ///       Console.WriteLine($"Контакт: {displayName}");
    ///   }
    /// </summary>
    public User ContactUser { get; set; } = null!;
}

/*
 * ============================================================================
 * ЗАДАНИЕ ДЛЯ ТЕБЯ (ПРАКТИКА):
 * ============================================================================
 * 
 * 1. Добавь ГРУППЫ КОНТАКТОВ (папки):
 *    Создай новую таблицу ContactGroup:
 *    - Id (int)
 *    - OwnerId (int, FK -> Users.Id)
 *    - Name (string) - например "Семья", "Работа", "Университет"
 *    - Color (string?) - цвет группы для UI
 *    
 *    Добавь в Contact:
 *    - GroupId (int?, FK -> ContactGroup.Id)
 *    
 *    Это позволит организовать контакты в папки!
 * 
 * 2. Добавь ДВУСТОРОННЮЮ ДРУЖБУ:
 *    Создай новую таблицу Friendship:
 *    - Id (int)
 *    - User1Id (int, FK)
 *    - User2Id (int, FK)
 *    - Status (enum: Pending, Accepted, Rejected)
 *    - RequestedById (int) - кто отправил запрос
 *    - CreatedAt (DateTime)
 *    - AcceptedAt (DateTime?)
 *    
 *    Workflow:
 *    1. User A отправляет запрос User B (Status = Pending)
 *    2. User B принимает (Status = Accepted) или отклоняет (Status = Rejected)
 *    3. Только после Accepted оба становятся друзьями
 * 
 * 3. Добавь ЗАМЕТКИ О КОНТАКТЕ:
 *    - Notes (string?) - приватные заметки о контакте
 *    Например: "Познакомились на конференции 2024", "Должен мне 500р"
 * 
 * 4. Добавь ИСТОРИЮ ВЗАИМОДЕЙСТВИЙ:
 *    - LastMessageAt (DateTime?) - когда последний раз переписывались
 *    - MessageCount (int) - сколько всего сообщений обменялись
 *    Это поможет сортировать контакты по активности
 * 
 * 5. Добавь КАСТОМНЫЕ НАСТРОЙКИ:
 *    - CustomRingtone (string?) - свой звук уведомления для этого контакта
 *    - NotificationsEnabled (bool) - получать ли уведомления от него
 *    - ShowTypingIndicator (bool) - показывать ли "печатает..."
 * 
 * ============================================================================
 * ВАЖНЫЕ SQL CONSTRAINTS:
 * ============================================================================
 * 
 * В DbContext добавь UNIQUE CONSTRAINT на (OwnerId, ContactUserId):
 * 
 *   entity.HasIndex(c => new { c.OwnerId, c.ContactUserId })
 *       .IsUnique();
 * 
 * Это гарантирует, что нельзя добавить один контакт дважды!
 * 
 * ============================================================================
 * ДОПОЛНИТЕЛЬНАЯ ВАЛИДАЦИЯ:
 * ============================================================================
 * 
 * В репозитории или сервисе добавь проверку:
 * - Нельзя добавить самого себя в контакты (OwnerId != ContactUserId)
 * 
 * Пример:
 *   if (ownerId == contactUserId)
 *       throw new InvalidOperationException("Нельзя добавить себя в контакты");
 * 
 * ============================================================================
 */
