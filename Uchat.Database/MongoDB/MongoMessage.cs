/*
 * ============================================================================
 * MONGODB DOCUMENT: MESSAGE (–°–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ)
 * ============================================================================
 * 
 * –ü–û–ß–ï–ú–£ MONGODB –î–õ–Ø –°–û–û–ë–©–ï–ù–ò–ô?
 * 
 * 1. SCHEMA-LESS –§–û–†–ú–ê–¢
 *    - –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π (—Ç–µ–∫—Å—Ç, —Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ, –æ–ø—Ä–æ—Å—ã, —Å–∏—Å—Ç–µ–º–Ω—ã–µ)
 *    - –ë–µ–∑ JOIN-–∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –≤–ª–æ–∂–µ–Ω–∏–π –∏ —Ä–µ–∞–∫—Ü–∏–π
 *    - –í–ª–æ–∂–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã (sender, attachments, reactions)
 * 
 * 2. –ê–¢–û–ú–ê–†–ù–´–ï –û–ü–ï–†–ê–¶–ò–ò
 *    - $set –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª–µ–π
 *    - $push –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –º–∞—Å—Å–∏–≤—ã (readBy, reactions)
 *    - $pull –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –º–∞—Å—Å–∏–≤–æ–≤
 *    - $inc –¥–ª—è —Å—á–µ—Ç—á–∏–∫–æ–≤
 * 
 *    –ü—Ä–∏–º–µ—Ä: –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é –ë–ï–ó –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –≤—Å–µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞:
 *      db.messages.updateOne(
 *        { _id: messageId },
 *        { $addToSet: { "reactions.üëç": userId } }
 *      )
 * 
 * 3. TTL INDEX (–∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π)
 *    - –°–æ–æ–±—â–µ–Ω–∏—è —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
 *    - –ù–µ –Ω—É–∂–µ–Ω CRON –¥–ª—è –æ—á–∏—Å—Ç–∫–∏
 * 
 * 4. –ì–û–†–ò–ó–û–ù–¢–ê–õ–¨–ù–û–ï –ú–ê–°–®–¢–ê–ë–ò–†–û–í–ê–ù–ò–ï
 *    - Sharding –ø–æ ChatId –∏–ª–∏ UserId
 *    - –ú–∏–ª–ª–∏–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ —Å–µ—Ä–≤–µ—Ä–∞–º
 * 
 * ============================================================================
 * –°–†–ê–í–ù–ï–ù–ò–ï –° SQL
 * ============================================================================
 * 
 * ‚ùå SQL (3 —Ç–∞–±–ª–∏—Ü—ã + JOIN):
 * 
 *    Messages:
 *    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
 *    ‚îÇ Id ‚îÇ SenderId ‚îÇ Content ‚îÇ ChatId ‚îÇ SentAt  ‚îÇ
 *    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
 *    
 *    MessageAttachments:
 *    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
 *    ‚îÇ Id ‚îÇ MessageId ‚îÇ Type ‚îÇ Url ‚îÇ
 *    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
 *    
 *    MessageReactions:
 *    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
 *    ‚îÇ Id ‚îÇ MessageId ‚îÇ Emoji  ‚îÇ UserId ‚îÇ
 *    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
 *    
 *    –ó–∞–ø—Ä–æ—Å:
 *    SELECT m.*, u.Username, u.AvatarUrl,
 *           a.Type, a.Url,
 *           r.Emoji, r.UserId
 *    FROM Messages m
 *    LEFT JOIN Users u ON m.SenderId = u.Id
 *    LEFT JOIN MessageAttachments a ON m.Id = a.MessageId
 *    LEFT JOIN MessageReactions r ON m.Id = r.MessageId
 *    WHERE m.ChatId = 1
 *    ORDER BY m.SentAt DESC
 *    LIMIT 50;
 *    
 *    ‚ùå –ü–†–û–ë–õ–ï–ú–´:
 *       - 3 JOIN-–∑–∞–ø—Ä–æ—Å–∞ (–º–µ–¥–ª–µ–Ω–Ω–æ!)
 *       - N+1 problem –¥–ª—è –≤–ª–æ–∂–µ–Ω–∏–π
 *       - –°–ª–æ–∂–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
 * 
 * ‚úÖ MongoDB (1 –¥–æ–∫—É–º–µ–Ω—Ç):
 * 
 *    {
 *      _id: ObjectId("..."),
 *      chatId: 1,
 *      sender: { id: 100, username: "alice", avatarUrl: "/alice.jpg" },
 *      content: "Check this photo",
 *      attachments: [
 *        { type: "image", url: "/photo.jpg", width: 1920, height: 1080 }
 *      ],
 *      reactions: {
 *        "üëç": [100, 200],
 *        "‚ù§Ô∏è": [300]
 *      },
 *      sentAt: ISODate("2024-01-15T10:30:00Z")
 *    }
 *    
 *    –ó–∞–ø—Ä–æ—Å:
 *    db.messages
 *      .find({ chatId: 1 })
 *      .sort({ sentAt: -1 })
 *      .limit(50)
 *    
 *    ‚úÖ –ü–õ–Æ–°–´:
 *       - –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å (–ë–ï–ó JOIN!)
 *       - –í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ–¥–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ
 *       - –ê—Ç–æ–º–∞—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
 * 
 * ============================================================================
 */

using MongoDB.Bson;
using MongoDB.Bson.Serialization.Attributes;

namespace Uchat.Database.MongoDB;

/// <summary>
/// –ú–æ–¥–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è MongoDB
/// –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ "messages"
/// 
/// –ö–∞–∂–¥—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç:
/// - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (chatId, senderId, sentAt)
/// - –ö–æ–Ω—Ç–µ–Ω—Ç (content, type, attachments)
/// - –í–ª–æ–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (sender info, reactions, readBy)
/// </summary>
public class MongoMessage
{
    // ========================================================================
    // PRIMARY KEY (MongoDB ObjectId)
    // ========================================================================
    // MongoDB –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ObjectId –≤–º–µ—Å—Ç–æ INT –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞
    // ObjectId = 12-–±–∞–π—Ç–æ–≤—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä:
    //   - 4 –±–∞–π—Ç–∞: timestamp (–≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è)
    //   - 5 –±–∞–π—Ç: random value
    //   - 3 –±–∞–π—Ç–∞: counter
    // 
    // –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
    //   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (–Ω–µ –Ω—É–∂–Ω–æ –∂–¥–∞—Ç—å –ë–î)
    //   - –£–Ω–∏–∫–∞–ª–µ–Ω –≥–ª–æ–±–∞–ª—å–Ω–æ (–º–æ–∂–Ω–æ –º–µ—Ä–∂–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤)
    //   - –°–æ–¥–µ—Ä–∂–∏—Ç timestamp (–º–æ–∂–Ω–æ –∏–∑–≤–ª–µ—á—å –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è)
    // ========================================================================
    
    /// <summary>
    /// –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Å–æ–æ–±—â–µ–Ω–∏—è
    /// –í MongoDB: _id (ObjectId)
    /// –í C#: string (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è)
    /// 
    /// –ü—Ä–∏–º–µ—Ä: "507f1f77bcf86cd799439011"
    /// </summary>
    [BsonId]
    [BsonRepresentation(BsonType.ObjectId)]
    public string Id { get; set; } = ObjectId.GenerateNewId().ToString();
    
    // ========================================================================
    // FOREIGN KEYS (—Å–≤—è–∑–∏ —Å SQL —Ç–∞–±–ª–∏—Ü–∞–º–∏)
    // ========================================================================
    // MongoDB —Ö—Ä–∞–Ω–∏—Ç –¢–û–õ–¨–ö–û ID, —Å–∞–º–∏ –¥–∞–Ω–Ω—ã–µ –≤ SQLite:
    // - ChatId ‚Üí ChatRooms.Id (SQLite)
    // - Sender.UserId ‚Üí Users.Id (SQLite)
    // 
    // –ó–∞—á–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å Sender –¥–∞–Ω–Ω—ã–µ?
    // - –ß—Ç–æ–±—ã –ù–ï –¥–µ–ª–∞—Ç—å JOIN –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π
    // - Sender –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç ‚Üí –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è
    // ========================================================================
    
    /// <summary>
    /// ID —á–∞—Ç–∞ (—Å—Å—ã–ª–∫–∞ –Ω–∞ ChatRooms.Id –≤ SQLite)
    /// –í MongoDB: chatId (int32)
    /// 
    /// –î–ª—è –õ–ò–ß–ù–´–• —Å–æ–æ–±—â–µ–Ω–∏–π:
    ///   - –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π ChatId
    ///   - –ò–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é directMessages
    /// 
    /// –î–ª—è –ì–†–£–ü–ü–û–í–´–• —Å–æ–æ–±—â–µ–Ω–∏–π:
    ///   - –†–µ–∞–ª—å–Ω—ã–π ChatRooms.Id –∏–∑ SQLite
    /// </summary>
    [BsonElement("chatId")]
    public int ChatId { get; set; }
    
    // ========================================================================
    // –í–õ–û–ñ–ï–ù–ù–´–ô –î–û–ö–£–ú–ï–ù–¢: –û–¢–ü–†–ê–í–ò–¢–ï–õ–¨ (–ë–ï–ó JOIN!)
    // ========================================================================
    // –í–º–µ—Å—Ç–æ JOIN –∫ —Ç–∞–±–ª–∏—Ü–µ Users:
    //   SELECT m.*, u.Username, u.AvatarUrl FROM Messages m JOIN Users u ...
    // 
    // MongoDB —Ö—Ä–∞–Ω–∏—Ç –∫–æ–ø–∏—é –¥–∞–Ω–Ω—ã—Ö –ø—Ä—è–º–æ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏:
    //   sender: { userId: 100, username: "alice", avatarUrl: "/alice.jpg" }
    // 
    // –ü–æ—á–µ–º—É –Ω–µ JOIN?
    //   - MongoDB –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç JOIN (–¥–æ –≤–µ—Ä—Å–∏–∏ 3.2)
    //   - –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —É—Å–∫–æ—Ä—è–µ—Ç —á—Ç–µ–Ω–∏–µ (–≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ–¥–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ)
    //   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç, –Ω–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è
    // ========================================================================
    
    /// <summary>
    /// –í–ª–æ–∂–µ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
    /// –í MongoDB: sender { userId, username, avatarUrl }
    /// 
    /// –≠—Ç–æ –ö–û–ü–ò–Ø –¥–∞–Ω–Ω—ã—Ö –∏–∑ Users —Ç–∞–±–ª–∏—Ü—ã (SQLite)
    /// –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    /// 
    /// –ü—Ä–∏–º–µ—Ä:
    /// {
    ///   "sender": {
    ///     "userId": 100,
    ///     "username": "alice",
    ///     "displayName": "Alice Smith",
    ///     "avatarUrl": "/avatars/alice.jpg"
    ///   }
    /// }
    /// </summary>
    [BsonElement("sender")]
    public MessageSender Sender { get; set; } = null!;
    
    // ========================================================================
    // –ö–û–ù–¢–ï–ù–¢ –°–û–û–ë–©–ï–ù–ò–Ø
    // ========================================================================
    
    /// <summary>
    /// –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
    /// –í MongoDB: content (string)
    /// 
    /// –î–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π: "Hello world!"
    /// –î–ª—è –º–µ–¥–∏–∞: –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º (–µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ –∫–∞—Ä—Ç–∏–Ω–∫–∞)
    /// –î–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö: "Alice joined the chat"
    /// </summary>
    [BsonElement("content")]
    public string Content { get; set; } = string.Empty;
    
    /// <summary>
    /// –¢–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è
    /// –í MongoDB: type (string)
    /// 
    /// –í–æ–∑–º–æ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
    /// - "text" - –æ–±—ã—á–Ω–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    /// - "image" - –∫–∞—Ä—Ç–∏–Ω–∫–∞
    /// - "video" - –≤–∏–¥–µ–æ
    /// - "file" - —Ñ–∞–π–ª
    /// - "voice" - –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    /// - "poll" - –æ–ø—Ä–æ—Å
    /// - "system" - —Å–∏—Å—Ç–µ–º–Ω–æ–µ ("Alice joined")
    /// </summary>
    [BsonElement("type")]
    public string Type { get; set; } = "text";
    
    // ========================================================================
    // –í–õ–û–ñ–ï–ù–ò–Ø (–ë–ï–ó –û–¢–î–ï–õ–¨–ù–û–ô –¢–ê–ë–õ–ò–¶–´!)
    // ========================================================================
    // SQL: –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ MessageAttachments —Å JOIN
    // MongoDB: –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ –ø—Ä—è–º–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ
    // 
    // –ü—Ä–∏–º–µ—Ä:
    // "attachments": [
    //   { "type": "image", "url": "/photo1.jpg", "width": 1920, "height": 1080 },
    //   { "type": "image", "url": "/photo2.jpg", "width": 800, "height": 600 }
    // ]
    // ========================================================================
    
    /// <summary>
    /// –°–ø–∏—Å–æ–∫ –≤–ª–æ–∂–µ–Ω–∏–π (—Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ, —Ñ–∞–π–ª—ã)
    /// –í MongoDB: attachments (array of objects)
    /// 
    /// –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ [] –µ—Å–ª–∏ –Ω–µ—Ç –≤–ª–æ–∂–µ–Ω–∏–π
    /// –ú–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–∞–ª—å–±–æ–º —Ñ–æ—Ç–æ)
    /// </summary>
    [BsonElement("attachments")]
    public List<MessageAttachment> Attachments { get; set; } = new();
    
    // ========================================================================
    // –†–ï–ê–ö–¶–ò–ò (–ê–¢–û–ú–ê–†–ù–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï!)
    // ========================================================================
    // SQL: –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ MessageReactions
    //   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    //   ‚îÇ Id ‚îÇ MessageId ‚îÇ Emoji  ‚îÇ UserId ‚îÇ
    //   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    //   ‚îÇ 1  ‚îÇ 100       ‚îÇ üëç     ‚îÇ 10     ‚îÇ
    //   ‚îÇ 2  ‚îÇ 100       ‚îÇ üëç     ‚îÇ 20     ‚îÇ
    //   ‚îÇ 3  ‚îÇ 100       ‚îÇ ‚ù§Ô∏è     ‚îÇ 30     ‚îÇ
    //   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    // 
    // MongoDB: –æ–±—ä–µ–∫—Ç —Å –º–∞—Å—Å–∏–≤–∞–º–∏ userIds
    //   "reactions": {
    //     "üëç": [10, 20],
    //     "‚ù§Ô∏è": [30]
    //   }
    // 
    // –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é –ê–¢–û–ú–ê–†–ù–û:
    //   db.messages.updateOne(
    //     { _id: messageId },
    //     { $addToSet: { "reactions.üëç": userId } }
    //   )
    // ========================================================================
    
    /// <summary>
    /// –†–µ–∞–∫—Ü–∏–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
    /// –í MongoDB: reactions (object)
    /// 
    /// –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
    /// {
    ///   "üëç": [100, 200, 300],  // userIds –∫—Ç–æ –ø–æ—Å—Ç–∞–≤–∏–ª üëç
    ///   "‚ù§Ô∏è": [150, 250],       // userIds –∫—Ç–æ –ø–æ—Å—Ç–∞–≤–∏–ª ‚ù§Ô∏è
    ///   "üòÇ": [100]             // userIds –∫—Ç–æ –ø–æ—Å—Ç–∞–≤–∏–ª üòÇ
    /// }
    /// 
    /// –ê—Ç–æ–º–∞—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
    /// - –î–æ–±–∞–≤–∏—Ç—å: $addToSet
    /// - –£–¥–∞–ª–∏—Ç—å: $pull
    /// </summary>
    [BsonElement("reactions")]
    public Dictionary<string, List<int>> Reactions { get; set; } = new();
    
    // ========================================================================
    // –°–¢–ê–¢–£–° –ü–†–û–ß–¢–ï–ù–ò–Ø (–ë–ï–ó –û–¢–î–ï–õ–¨–ù–û–ô –¢–ê–ë–õ–ò–¶–´!)
    // ========================================================================
    // SQL: —Ç–∞–±–ª–∏—Ü–∞ MessageReadReceipts
    // MongoDB: –º–∞—Å—Å–∏–≤ userIds –ø—Ä—è–º–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ
    // 
    // –î–æ–±–∞–≤–∏—Ç—å userId –≤ readBy:
    //   db.messages.updateOne(
    //     { _id: messageId },
    //     { $addToSet: { readBy: userId } }
    //   )
    // ========================================================================
    
    /// <summary>
    /// –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—á–∏—Ç–∞–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ
    /// –í MongoDB: readBy (array of int32)
    /// 
    /// –ü—Ä–∏–º–µ—Ä: [100, 200, 300]
    /// 
    /// –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ [] = –Ω–∏–∫—Ç–æ –Ω–µ –ø—Ä–æ—á–∏—Ç–∞–ª
    /// –°–æ–¥–µ—Ä–∂–∏—Ç userId –∏–∑ Users.Id (SQLite)
    /// </summary>
    [BsonElement("readBy")]
    public List<int> ReadBy { get; set; } = new();
    
    // ========================================================================
    // –í–†–ï–ú–ï–ù–ù–´–ï –ú–ï–¢–ö–ò
    // ========================================================================
    
    /// <summary>
    /// –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è (UTC)
    /// –í MongoDB: sentAt (ISODate)
    /// 
    /// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
    /// - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (ORDER BY sentAt DESC)
    /// - TTL Index (–∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π)
    /// 
    /// –ü—Ä–∏–º–µ—Ä: ISODate("2024-01-15T10:30:00Z")
    /// </summary>
    [BsonElement("sentAt")]
    [BsonDateTimeOptions(Kind = DateTimeKind.Utc)]
    public DateTime SentAt { get; set; } = DateTime.UtcNow;
    
    /// <summary>
    /// –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (UTC)
    /// –í MongoDB: editedAt (ISODate –∏–ª–∏ null)
    /// 
    /// NULL = —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å
    /// NOT NULL = —Å–æ–æ–±—â–µ–Ω–∏–µ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ
    /// </summary>
    [BsonElement("editedAt")]
    [BsonDateTimeOptions(Kind = DateTimeKind.Utc)]
    public DateTime? EditedAt { get; set; }
    
    // ========================================================================
    // –§–õ–ê–ì–ò
    // ========================================================================
    
    /// <summary>
    /// –§–ª–∞–≥ "—Å–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ"
    /// –í MongoDB: isDeleted (bool)
    /// 
    /// false = —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–∏–¥–Ω–æ
    /// true = —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–∫—Ä—ã—Ç–æ (–Ω–æ –Ω–µ —É–¥–∞–ª–µ–Ω–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏)
    /// 
    /// –î–ª—è –ø–æ–ª–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π TTL Index
    /// </summary>
    [BsonElement("isDeleted")]
    public bool IsDeleted { get; set; }
    
    // ========================================================================
    // –û–¢–í–ï–¢ –ù–ê –°–û–û–ë–©–ï–ù–ò–ï (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û)
    // ========================================================================
    
    /// <summary>
    /// ID —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ —ç—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –æ—Ç–≤–µ—Ç–æ–º
    /// –í MongoDB: replyToMessageId (ObjectId –∏–ª–∏ null)
    /// 
    /// NULL = –æ–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    /// NOT NULL = –æ—Ç–≤–µ—Ç –Ω–∞ –¥—Ä—É–≥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    /// 
    /// –ü—Ä–∏–º–µ—Ä:
    /// {
    ///   "replyToMessageId": "507f1f77bcf86cd799439011",
    ///   "content": "I agree!"
    /// }
    /// </summary>
    [BsonElement("replyToMessageId")]
    [BsonRepresentation(BsonType.ObjectId)]
    public string? ReplyToMessageId { get; set; }
}

// ============================================================================
// –í–õ–û–ñ–ï–ù–ù–´–ï –ö–õ–ê–°–°–´ (Embedded Documents)
// ============================================================================

/// <summary>
/// –í–ª–æ–∂–µ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è
/// –í MongoDB: –≤—Å—Ç—Ä–æ–µ–Ω –≤ messages.sender
/// 
/// –≠—Ç–æ –ö–û–ü–ò–Ø –¥–∞–Ω–Ω—ã—Ö –∏–∑ Users (SQLite)
/// –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è
/// </summary>
public class MessageSender
{
    /// <summary>
    /// ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Users.Id (SQLite)
    /// </summary>
    [BsonElement("userId")]
    public int UserId { get; set; }
    
    /// <summary>
    /// Username –∏–∑ Users.Username (SQLite)
    /// –ö–æ–ø–∏—è –Ω–∞ –º–æ–º–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
    /// </summary>
    [BsonElement("username")]
    public string Username { get; set; } = string.Empty;
    
    /// <summary>
    /// –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è –∏–∑ Users.DisplayName (SQLite)
    /// </summary>
    [BsonElement("displayName")]
    public string DisplayName { get; set; } = string.Empty;
    
    /// <summary>
    /// URL –∞–≤–∞—Ç–∞—Ä–∞ –∏–∑ Users.AvatarUrl (SQLite)
    /// NULL = –∞–≤–∞—Ç–∞—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    /// </summary>
    [BsonElement("avatarUrl")]
    public string? AvatarUrl { get; set; }
}

/// <summary>
/// –í–ª–æ–∂–µ–Ω–∏–µ –∫ —Å–æ–æ–±—â–µ–Ω–∏—é (—Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ, —Ñ–∞–π–ª)
/// –í MongoDB: –≤—Å—Ç—Ä–æ–µ–Ω –≤ messages.attachments[]
/// </summary>
public class MessageAttachment
{
    /// <summary>
    /// –¢–∏–ø –≤–ª–æ–∂–µ–Ω–∏—è
    /// "image" | "video" | "file" | "voice" | "audio"
    /// </summary>
    [BsonElement("type")]
    public string Type { get; set; } = string.Empty;
    
    /// <summary>
    /// URL —Ñ–∞–π–ª–∞
    /// –ü—Ä–∏–º–µ—Ä: "/uploads/2024/01/photo_12345.jpg"
    /// </summary>
    [BsonElement("url")]
    public string Url { get; set; } = string.Empty;
    
    /// <summary>
    /// –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –≤ –±–∞–π—Ç–∞—Ö
    /// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–æ–≤ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    /// </summary>
    [BsonElement("size")]
    public long Size { get; set; }
    
    /// <summary>
    /// –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞
    /// –ü—Ä–∏–º–µ—Ä: "vacation_photo.jpg"
    /// </summary>
    [BsonElement("fileName")]
    public string? FileName { get; set; }
    
    // ========================================================================
    // –î–õ–Ø –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô –ò –í–ò–î–ï–û
    // ========================================================================
    
    /// <summary>
    /// –®–∏—Ä–∏–Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è/–≤–∏–¥–µ–æ –≤ –ø–∏–∫—Å–µ–ª—è—Ö
    /// NULL –¥–ª—è —Ñ–∞–π–ª–æ–≤ –∏ –∞—É–¥–∏–æ
    /// </summary>
    [BsonElement("width")]
    public int? Width { get; set; }
    
    /// <summary>
    /// –í—ã—Å–æ—Ç–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è/–≤–∏–¥–µ–æ –≤ –ø–∏–∫—Å–µ–ª—è—Ö
    /// NULL –¥–ª—è —Ñ–∞–π–ª–æ–≤ –∏ –∞—É–¥–∏–æ
    /// </summary>
    [BsonElement("height")]
    public int? Height { get; set; }
    
    /// <summary>
    /// –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ/–∞—É–¥–∏–æ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    /// NULL –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ —Ñ–∞–π–ª–æ–≤
    /// </summary>
    [BsonElement("duration")]
    public int? Duration { get; set; }
    
    /// <summary>
    /// URL –ø—Ä–µ–≤—å—é (thumbnail) –¥–ª—è –≤–∏–¥–µ–æ
    /// NULL –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤
    /// </summary>
    [BsonElement("thumbnailUrl")]
    public string? ThumbnailUrl { get; set; }
}

/*
 * ============================================================================
 * –ü–†–ò–ú–ï–† –î–û–ö–£–ú–ï–ù–¢–ê –í MONGODB
 * ============================================================================
 * 
 * {
 *   "_id": ObjectId("507f1f77bcf86cd799439011"),
 *   "chatId": 1,
 *   "sender": {
 *     "userId": 100,
 *     "username": "alice",
 *     "displayName": "Alice Smith",
 *     "avatarUrl": "/avatars/alice.jpg"
 *   },
 *   "content": "Check out this amazing sunset! üåÖ",
 *   "type": "image",
 *   "attachments": [
 *     {
 *       "type": "image",
 *       "url": "/uploads/2024/01/sunset_12345.jpg",
 *       "size": 2048576,
 *       "fileName": "sunset.jpg",
 *       "width": 1920,
 *       "height": 1080,
 *       "thumbnailUrl": "/uploads/2024/01/sunset_12345_thumb.jpg"
 *     }
 *   ],
 *   "reactions": {
 *     "üëç": [100, 200, 300],
 *     "‚ù§Ô∏è": [150, 250],
 *     "üî•": [100]
 *   },
 *   "readBy": [100, 200, 300, 150, 250],
 *   "sentAt": ISODate("2024-01-15T10:30:00Z"),
 *   "editedAt": null,
 *   "isDeleted": false,
 *   "replyToMessageId": null
 * }
 * 
 * ============================================================================
 * –†–ê–ó–ú–ï–† –î–û–ö–£–ú–ï–ù–¢–ê
 * ============================================================================
 * 
 * MongoDB –ª–∏–º–∏—Ç: 16 –ú–ë –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç
 * 
 * –¢–∏–ø–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: ~1-5 –ö–ë
 * –° 10 –≤–ª–æ–∂–µ–Ω–∏—è–º–∏: ~10-50 –ö–ë
 * –° 1000 —Ä–µ–∞–∫—Ü–∏–π: ~50-100 –ö–ë
 * 
 * –≠—Ç–æ –ù–ê–ú–ù–û–ì–û –º–µ–Ω—å—à–µ –ª–∏–º–∏—Ç–∞ 16 –ú–ë!
 * 
 * ============================================================================
 */
