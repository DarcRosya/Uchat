# üîç –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–µ–∫—Ç–∞ Uchat

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

### 1. ‚úÖ –ö–†–ò–¢–ò–ß–ù–û: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π catch –≤ LoginAsync
**–§–∞–π–ª:** `Uchat.Server/Services/Auth/AuthService.cs`
**–°—Ç–∞—Ç—É—Å:** –ò–°–ü–†–ê–í–õ–ï–ù–û
**–ß—Ç–æ –±—ã–ª–æ:**
```csharp
try {
    if (existingUser == null) throw new InvalidOperationException("Invalid credentials");
} catch (Exception ex) {
    Console.WriteLine(ex.Message); // ‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Ä—è–ª–∞—Å—å
}
// –ö–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–ª —Ä–∞–±–æ—Ç—É —Å null
```
**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:** –£–±—Ä–∞–ª –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã–π try-catch –±–ª–æ–∫

---

### 2. ‚úÖ –ö–†–ò–¢–ò–ß–ù–û: –¢–∞–∫–∞—è –∂–µ –ø—Ä–æ–±–ª–µ–º–∞ –≤ RegisterAsync
**–§–∞–π–ª:** `Uchat.Server/Services/Auth/AuthService.cs`
**–°—Ç–∞—Ç—É—Å:** –ò–°–ü–†–ê–í–õ–ï–ù–û
**–ß—Ç–æ –±—ã–ª–æ:** –¢–∞ –∂–µ –ø—Ä–æ–±–ª–µ–º–∞ —Å catch –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:** –£–±—Ä–∞–ª –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã–π try-catch –±–ª–æ–∫

---

### 3. ‚úÖ Nullable warnings –≤ User.cs
**–§–∞–π–ª:** `Database/Entities/User.cs`
**–°—Ç–∞—Ç—É—Å:** –ò–°–ü–†–ê–í–õ–ï–ù–û
**–ß—Ç–æ –±—ã–ª–æ:**
```csharp
public User User { get; set; } // ‚ö†Ô∏è CS8618
public ICollection<UserSecurityToken> SecurityTokens { get; set; } // ‚ö†Ô∏è CS8618
```
**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
```csharp
public required User User { get; set; }
public ICollection<UserSecurityToken> SecurityTokens { get; set; } = new List<UserSecurityToken>();
```

---

### 4. ‚úÖ –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π
**–§–∞–π–ª:** `Uchat/ClientConections.cs`
**–°—Ç–∞—Ç—É—Å:** –ò–°–ü–†–ê–í–õ–ï–ù–û
**–ß—Ç–æ –±—ã–ª–æ:** –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ–ø–∞–¥–∞–ª–æ –ø—Ä–∏ –æ—à–∏–±–∫–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:** 
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –≤ –ø–æ–ª–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "Failed to send"

---

### 5. ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è username –¥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
**–§–∞–π–ª:** `Uchat/ClientConections.cs`
**–°—Ç–∞—Ç—É—Å:** –ò–°–ü–†–ê–í–õ–ï–ù–û
**–ß—Ç–æ –±—ã–ª–æ:** `name` –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è –∫–∞–∫ –ø–æ–ª–µ –∫–ª–∞—Å—Å–∞ –¥–æ –∑–∞–ø—É—Å–∫–∞ `Program.Main()`
**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:** –ü–µ—Ä–µ–Ω—ë—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤

---

## ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢ –í–ù–ò–ú–ê–ù–ò–Ø

### 6. ‚ö†Ô∏è Hardcoded chatId = "1"
**–§–∞–π–ª:** `Uchat/ClientConections.cs:21`
**–ü—Ä–æ–±–ª–µ–º–∞:**
```csharp
private string currentChatId = "1"; // FOR DEBUG PURPOSE ONLY!!!
```
**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –°–æ–∑–¥–∞—Ç—å UI –¥–ª—è –≤—ã–±–æ—Ä–∞/–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —á–∞—Ç–æ–≤
- –ü–æ–ª—É—á–∞—Ç—å —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞
- –î–æ–±–∞–≤–∏—Ç—å API endpoint: `GET /api/chats`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô (–ø–æ–∫–∞ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

---

### 7. ‚úÖ Hardcoded –ø—É—Ç—å –∫ Uchat.exe
**–§–∞–π–ª:** `LoginFormAvalonia/MainWindow.axaml.cs`
**–°—Ç–∞—Ç—É—Å:** –ò–°–ü–†–ê–í–õ–ï–ù–û
**–ß—Ç–æ –±—ã–ª–æ:** Hardcoded –ø—É—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è Debug –±–∏–ª–¥–∞
**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:** 
- –ò—â–µ—Ç Uchat.exe –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ª–æ–∫–∞—Ü–∏—è—Ö (production, debug, release)
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Ä—è–¥–æ–º —Å LoginForm.exe ‚Üí Debug ‚Üí Release ‚Üí dotnet run
- –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ª—é–±–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

### 8. ‚úÖ LiteDb —Å–µ–∫—Ü–∏—è –≤ appsettings.json
**–§–∞–π–ª:** `Uchat.Server/appsettings.json`
**–°—Ç–∞—Ç—É—Å:** –ò–°–ü–†–ê–í–õ–ï–ù–û
**–ß—Ç–æ –±—ã–ª–æ:** LiteDB –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ –∫–æ–¥–∞
**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:** –î–æ–±–∞–≤–∏–ª —Å–µ–∫—Ü–∏—é LiteDb –≤ appsettings.json —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—É—Ç—è–º–∏

---

### 9. ‚úÖ Rate limiting –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Å–ø–∞–º–∞
**–§–∞–π–ª:** `Uchat.Server/Program.cs`
**–°—Ç–∞—Ç—É—Å:** –ò–°–ü–†–ê–í–õ–ï–ù–û
**–ß—Ç–æ –±—ã–ª–æ:** –ú–æ–∂–Ω–æ –±—ã–ª–æ —Å–ø–∞–º–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ `/api/auth/login`
**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –î–æ–±–∞–≤–∏–ª FixedWindowLimiter –¥–ª—è auth endpoints (10 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç–∞)
- –î–æ–±–∞–≤–∏–ª –æ–±—â–∏–π limiter –¥–ª—è API (100 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç–∞)
- –ü—Ä–∏–º–µ–Ω–∏–ª –∞—Ç—Ä–∏–±—É—Ç `[EnableRateLimiting("auth")]` –Ω–∞ AuthController

---

## ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢ –í–ù–ò–ú–ê–ù–ò–Ø

### 10. ‚ö†Ô∏è Hardcoded chatId = "1"
**–§–∞–π–ª:** `Uchat/ClientConections.cs:21`
**–ü—Ä–æ–±–ª–µ–º–∞:**
```csharp
private string currentChatId = "1"; // FOR DEBUG PURPOSE ONLY!!!
```
**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –°–æ–∑–¥–∞—Ç—å UI –¥–ª—è –≤—ã–±–æ—Ä–∞/–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —á–∞—Ç–æ–≤
- –ü–æ–ª—É—á–∞—Ç—å —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞
- –î–æ–±–∞–≤–∏—Ç—å API endpoint: `GET /api/chats`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô (–ø–æ–∫–∞ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

---

## üöÄ –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨, –ö–û–¢–û–†–£–Æ –ù–£–ñ–ù–û –î–û–ë–ê–í–ò–¢–¨

### 11. üìã API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
**–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ endpoints:**

```csharp
// ChatsController.cs
[ApiController]
[Route("api/chats")]
public class ChatsController : ControllerBase
{
    [HttpGet]
    public async Task<IActionResult> GetUserChats() { }
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô

---

### 12. üë• API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–∞—Ç–∞–º–∏
    public async Task<IActionResult> GetMembers(string chatId) { }
    
    [HttpPost("{chatId}/members")]
    public async Task<IActionResult> AddMember(string chatId, int userId) { }
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô

---

### 13. üîç API –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
**–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ endpoints:**

```csharp
// UsersController.cs
[ApiController]
[Route("api/users")]
public class UsersController : ControllerBase
{
    [HttpGet("me")]
    public async Task<IActionResult> GetCurrentUser() { }
    
    [HttpPut("me")]
    public async Task<IActionResult> UpdateProfile(UpdateProfileDto dto) { }
    
    [HttpGet("search")]
    public async Task<IActionResult> SearchUsers(string query) { }
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### 14. üîÑ –û–±—ä–µ–¥–∏–Ω–∏—Ç—å LoginForm –∏ Uchat –≤ –æ–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å
**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
- –î–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö .exe —Ñ–∞–π–ª–∞
- –ü–µ—Ä–µ–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
- –°–ª–æ–∂–Ω–µ–µ –¥–µ–ø–ª–æ–∏—Ç—å

**–†–µ—à–µ–Ω–∏–µ:**
```
Uchat.Client/
‚îú‚îÄ‚îÄ Views/
‚îÇ   ‚îú‚îÄ‚îÄ LoginWindow.axaml
‚îÇ   ‚îî‚îÄ‚îÄ ChatWindow.axaml
‚îú‚îÄ‚îÄ Services/
‚îî‚îÄ‚îÄ Program.cs
```

**–ü–ª—é—Å—ã:**
- –û–¥–∏–Ω –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª
- –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ—â–µ –Ω–∞–≤–∏–≥–∞—Ü–∏—è

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–ò–ó–ö–ò–ô (—Ä–∞–±–æ—Ç–∞–µ—Ç –∏ —Ç–∞–∫)

---

### 15. üìÅ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏
**–¢–µ–∫—É—â–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è:**
- `LoginFormAvalonia` ‚Üí `Uchat.Auth` –∏–ª–∏ `Uchat.Login`
- `Uchat` ‚Üí `Uchat.Desktop` –∏–ª–∏ `Uchat.Client`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–ò–ó–ö–ò–ô

---

## üìä –ò–¢–û–ì–û

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:** 0 (–≤—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã ‚úÖ)

**–¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è:** 1
- Hardcoded chatId (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:** 3
- Messages API (–í–´–°–û–ö–ò–ô –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
- Chats API (–í–´–°–û–ö–ò–ô –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
- Users API (–°–†–ï–î–ù–ò–ô –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:** 2 (–ù–ò–ó–ö–ò–ô –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** 1 (Rate limiting - –°–†–ï–î–ù–ò–ô –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å RegisterAsync/LoginAsync
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å nullable warnings
3. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é username
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

### –§–∞–∑–∞ 2: –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (—Å–ª–µ–¥—É—é—â–∞—è)
1. –°–æ–∑–¥–∞—Ç—å MessagesController –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
2. –°–æ–∑–¥–∞—Ç—å ChatsController –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–∞—Ç–∞–º–∏
3. –î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è –≤—ã–±–æ—Ä–∞ —á–∞—Ç–æ–≤
4. –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —á–∞—Ç–∞

### –§–∞–∑–∞ 3: –£–ª—É—á—à–µ–Ω–∏—è
1. –î–æ–±–∞–≤–∏—Ç—å rate limiting
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å hardcoded –ø—É—Ç–∏
3. –î–æ–±–∞–≤–∏—Ç—å UsersController
4. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –§–∞–∑–∞ 4: –ü–æ–ª–∏—Ä–æ–≤–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
1. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å LoginForm –∏ Uchat
2. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã
3. –£–ª—É—á—à–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:** 2 (–ù–ò–ó–ö–ò–ô –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å RegisterAsync/LoginAsync
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å nullable warnings
3. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é username
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
5. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å LiteDb –≤ appsettings.json
6. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å rate limiting