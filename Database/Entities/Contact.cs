using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace Uchat.Database.Entities;

/// <summary>
/// –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–≤—è–∑—å "–û–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º" –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ –µ–≥–æ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–æ–º.
/// –≠—Ç–∞ —Ç–∞–±–ª–∏—Ü–∞ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏:
/// 1. –°–ø–∏—Å–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (–∞–¥—Ä–µ—Å–Ω–∞—è –∫–Ω–∏–≥–∞)
/// 2. –°—Ç–∞—Ç—É—Å–∞ –¥—Ä—É–∂–±—ã (–∑–∞—è–≤–∫–∏, –¥—Ä—É–∑—å—è, —á—Å)
/// 3. –ë—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–∏—á–Ω–æ–º—É —á–∞—Ç—É
/// </summary>
public class Contact
{
    // ========================================================================
    // PRIMARY KEY
    // ========================================================================

    public int Id { get; set; }
    
    // ========================================================================
    // FOREIGN KEYS & IDENTITY
    // ========================================================================
    
    /// <summary>
    /// ID –≤–ª–∞–¥–µ–ª—å—Ü–∞ —ç—Ç–æ–π –∑–∞–ø–∏—Å–∏ (–∫—Ç–æ –¥–æ–±–∞–≤–∏–ª –∫–æ–Ω—Ç–∞–∫—Ç).
    /// </summary>
    public int OwnerId { get; set; }
    
    /// <summary>
    /// ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ–Ω—Ç–∞–∫—Ç–µ.
    /// </summary>
    public int ContactUserId { get; set; }
    
    // ========================================================================
    // –õ–û–ì–ò–ö–ê –û–¢–ù–û–®–ï–ù–ò–ô (Friendship replacement)
    // ========================================================================

    /// <summary>
    /// –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –æ—Ç–Ω–æ—à–µ–Ω–∏–π.
    /// –ó–∞–º–µ–Ω—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É Friendship.
    /// </summary>
    public ContactStatus Status { get; set; } = ContactStatus.None;

    // ========================================================================
    // –°–°–´–õ–ö–ê –ù–ê –ß–ê–¢ (Optimization)
    // ========================================================================

    /// <summary>
    /// ID –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ —á–∞—Ç–∞ —Å —ç—Ç–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (–µ—Å–ª–∏ –æ–Ω —Å–æ–∑–¥–∞–Ω).
    /// –ü–æ–∑–≤–æ–ª—è–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —á–∞—Ç –±–µ–∑ –ø–æ–∏—Å–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ ChatRooms.
    /// </summary>
    public int? SavedChatRoomId { get; set; }

    // ========================================================================
    // –ü–ï–†–°–û–ù–ê–õ–ò–ó–ê–¶–ò–Ø (–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞)
    // ========================================================================
    
    /// <summary>
    /// –õ–∏—á–Ω–æ–µ –∏–º—è –¥–ª—è –∫–æ–Ω—Ç–∞–∫—Ç–∞ (–∫–∞–∫ —è –µ–≥–æ –∑–∞–ø–∏—Å–∞–ª).
    /// –ï—Å–ª–∏ null -> –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ContactUser.DisplayName.
    /// </summary>
    public string? Nickname { get; set; }

    public bool NotificationsEnabled { get; set; } = true;

    /// <summary>
    /// –í –∏–∑–±—Ä–∞–Ω–Ω–æ–º (–∑–∞–∫—Ä–µ–ø–ª–µ–Ω –≤–≤–µ—Ä—Ö—É).
    /// </summary>
    public bool IsFavorite { get; set; }
    public bool IsBlocked { get; set; }

    // ========================================================================
    // –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ò –°–û–†–¢–ò–†–û–í–ö–ê
    // ========================================================================
    
    public DateTime AddedAt { get; set; } = DateTime.UtcNow;

    /// <summary>
    /// –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ —Å–ø–∏—Å–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤.
    /// –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ SavedChatRoomId.
    /// </summary>
    public DateTime? LastMessageAt { get; set; }

    public int MessageCount { get; set; }
    
    // ========================================================================
    // NAVIGATION PROPERTIES
    // ========================================================================
    
    public User Owner { get; set; } = null!;
    public User ContactUser { get; set; } = null!;

    /// <summary>
    /// –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–∞–º –æ–±—ä–µ–∫—Ç —á–∞—Ç–∞ (–¥–ª—è Include).
    /// </summary>
    public ChatRoom? SavedChatRoom { get; set; }
}

public enum ContactStatus
{
    /// <summary>
    /// –ü—Ä–æ—Å—Ç–æ –∫–æ–Ω—Ç–∞–∫—Ç (–±—ã–ª –¥–∏–∞–ª–æ–≥, –Ω–æ –Ω–µ –¥—Ä—É–∑—å—è).
    /// </summary>
    None = 0,             
    
    /// <summary>
    /// ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ –¥—Ä—É–∑—å—è.
    /// </summary>
    Friend = 1,           
    
    /// <summary>
    /// ‚è≥ –Ø –æ—Ç–ø—Ä–∞–≤–∏–ª –∑–∞—è–≤–∫—É –≤ –¥—Ä—É–∑—å—è (–∂–¥—É –æ—Ç–≤–µ—Ç–∞).
    /// </summary>
    RequestSent = 2,      
    
    /// <summary>
    /// üì© –ú–Ω–µ –ø—Ä–∏—à–ª–∞ –∑–∞—è–≤–∫–∞ (–≤–∏–∂—É –∫–Ω–æ–ø–∫—É "–ü—Ä–∏–Ω—è—Ç—å").
    /// </summary>
    RequestReceived = 3,  
    
    /// <summary>
    /// ‚õî –Ø –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    /// </summary>
    Blocked = 4           
}